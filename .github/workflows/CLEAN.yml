name: NUCLEAR CLEANUP - REMOVE ALL DATA FILES
on:
  workflow_dispatch:
    inputs:
      confirm:
        description: 'Type "DESTROY" to delete all data files'
        required: true
        default: 'NO'

permissions:
  contents: write

jobs:
  nuclear-clean:
    if: inputs.confirm == 'DESTROY'
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: Checkout with ALL history
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Get all history
          
      - name: Remove ALL data files
        run: |
          echo "=== NUCLEAR CLEANUP STARTING ==="
          
          # Remove entire data directories
          rm -rf detections/
          rm -rf frames/
          
          # Remove any leftover JSON/CSV files
          find . -name "*.json" -type f -delete
          find . -name "*.csv" -type f -delete
          find . -name "*.png" -type f -delete
          find . -name "*.jpg" -type f -delete
          find . -name "*.gif" -type f -delete
          
          # Keep only essential files
          echo "Keeping only essential files..."
          ls -la
          
      - name: Create .gitignore to prevent future bloat
        run: |
          cat > .gitignore << 'EOF'
          # NEVER commit these
          detections/
          frames/
          *.json
          *.csv
          *.png
          *.jpg
          *.jpeg
          *.gif
          *.mp4
          *.log
          *.tmp
          *.fits
          *.fits.gz
          
          # Python
          __pycache__/
          *.py[cod]
          *$py.class
          *.so
          .Python
          build/
          develop-eggs/
          dist/
          downloads/
          eggs/
          .eggs/
          lib/
          lib64/
          parts/
          sdist/
          var/
          wheels/
          *.egg-info/
          .installed.cfg
          *.egg
          
          # IDE
          .vscode/
          .idea/
          *.swp
          *.swo
          EOF
          
      - name: Commit the purge
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          git add .
          git commit -m "NUCLEAR: Remove all data files (23k+ files deleted)"
          
      - name: Force push (rewrite history)
        run: |
          # Force push to overwrite remote
          git push origin HEAD --force
          
          echo "âœ… PURGE COMPLETE!"
          echo "Repository should now be clean and usable."
